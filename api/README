Building JSON API in Phoenix


1. Build phoenix project for smartphoneapi
2. Configure proxy
    upstream phoenix_smartphoneapi_upstream {        
        server 127.0.0.1:4001;                            
    }   
    ...
    listen 80;                                          
    location /smartphoneapi/ {                          
      proxy_redirect off;                               
      proxy_pass http://phoenix_smartphoneapi_upstream; 
    }  

3. Create JSON model for usage data
    $mix phoenix.gen.json Usage usage userid:integer startedate:datetime duration:string activity:string
4. Fix router
    use Smartphoneapi.Web, :router
    pipeline :api do
       dplug :accepts, ["json"]
       dresources "/smartphoneapi/usage", Smartphoneapi.UsageController
    end
    end
5. Try POST and GET with Postman
    {
      "usage":{
          "userid": "1",
          "startedate": "1488272591",
          "duration_s": "30",
          "activity": "mainscreen"
      }
    }
    
6. Build phoenix project for registration/login
     $mix phoenix.new authapi
7. Configure proxy
    upstream phoenix_authapi_upstream {      
        server 127.0.0.1:4002;                   
    }    
    ...
    location /authapi/ {                         
        proxy_redirect off;                        
        proxy_pass http://phoenix_authapi_upstream;
    }   
8. Create JSON model
    mix phoenix.gen.json Authentication authentication nickname:string email:string password:string birthdate:datetime height:float weight:float groupid:integer gender:boolean #id is autogenerated
9. Fix router
    defmodule Authapi.Router do
        use Authapi.Web, :router
        
        pipeline :api do
            plug :accepts, ["json"]
            resources "/authapi/authentication", Authapi.AuthenticationController
        end
    end
10. Test GET and POST with Postman
    {
      "authentication":{
          "email": "test1@abc.com",
          "password": "test1",
          "nickname": "Test1",
          "height": "187.3",
          "weight": "93.1",
          "groupid": "9001",
          "birthdate": "1990-02-28T12:10:33",
          "gender": "true"
      }
    }


